{% extends "base.html" %}

{% block sidebar %}
<div class="sidebar gradient">
    <hr class='navline navline1'/>
    <h2 class='navtitle'>CLIENT RECORDS</h2>
    <hr class='navline'/>
    
    <div class='sidebar-menu'>
        <h4>Client Information</h4>
        <ul class="right">
            <li class="nobullets"><a href='{{ url_for('listClients') }}' class='opt2'>View Client</a></li>
            <li class="nobullets"><a href='{{ url_for('addClient') }}' class='opt2'>Add New Client</a></li>
        </ul> 
        <h4>Detachment Information</h4>
        <ul class="right">
            <li class="nobullets"><a href='{{ url_for('listDetachments') }}' class='opt2'>View Detachment</a></li>
        </ul> 
    </div>

</div>
{% endblock sidebar %}


{% block content %}
<h1>Detachment Information</h1>
<h3>Client: {{ Client.Name }}</h3>
<hr>
<span style='float:right;'>Detachment Code: <b>{{ DE.Code }}</b></span>
<br/>
<center><h1>{{ DE.Name }}</h1></center>

<br/>
<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Basic Info</a></li>
    <li><a href="#tabs-2">Payroll Rates</a></li>
    <li><a href="#tabs-3">Allowances</a></li>
    <li><a href="#tabs-4">Contact Persons</a></li>
  </ul>
    <div id="tabs-1">
    <br/>
    <table>
        <tr>
            <td><label>Status: </label></td>
            <td>{{ DE.Status}}</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td><label>Start Date: </label></td>
            <td>{{DE.StartDate}}</td>
        </tr>
        <tr>
            <td><label>End Date: </label></td>
            <td>{{DE.EndDate}}</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td><label>City: </label></td>
            <td>{{DE.City}}</td>
        </tr>
        <tr>
            <td><label>Address: </label></td>
            <td>{{DE.Address}}</td>
        </tr>
    </table>
    <form class='pure-form' method='link' action="{{ url_for('editDetachment', ClientID=Client.ID, DetachID=DE.ID) }}">
        <button class='pure-button editBtn'>Edit Record</button>
    </form>
    <br/><br/>
  </div>
  <div id="tabs-2">
    <form class='pure-form pure-form-aligned'>
    <table>
        <tr>
            <td><label>Effective Date: </label></td>
            <td></td>
        </tr>
        <tr>
            <td><label>Rate type:</label></td>
            <td>
                <select name="rate_type">
                    <option value="H">Hourly</option>
                    <option value="M">Monthly</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><label>Regular: </label></td>
            <td><input type='number' value=''/></td>
        </tr>
        <tr>
            <td><label>OT: </label></td>
            <td><input type='number' value=''/></td>
        </tr>
        <tr>
            <td><label>Night differential: </label></td>
            <td><input type='number' value=''/></td>
        </tr>
        <tr>
            <td><label>ECOLA (daily): </label></td>
            <td><input type='number' value=''/></td>
        </tr>
        <tr>
            <td><label>Legal Holiday: </label></td>
            <td><input type='number' value=''/></td>
            <td><label>Mode of Release: </label></td>
            <td>
                <select name="LH_MOR">
                    <option value="PD">Pay Day</option>
                    <option value="YE">Year End</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><label>Special Holiday: </label></td>
            <td><input type='number' value=''/></td>
            <td><label>Mode of Release: </label></td>
            <td>
                <select name="SH_MOR">
                    <option value="PD">Pay Day</option>
                    <option value="YE">Year End</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><label>5-days Incentive: </label></td>
            <td><input type='number' value=''/></td>
            <td><label>Mode of Release: </label></td>
            <td>
                <select name="SH_MOR">
                    <option value="PD">Pay Day</option>
                    <option value="YE">Year End</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><label>13th Month: </label></td>
            <td><input type='number' value=''/></td>
        </tr>
        <tr>
            <td><label>Pag-ibig Premium: </label></td>
            <td><input type='number' value=''/></td>
        </tr>
        <tr>
            <td><label>PhilHealth Premium: </label></td>
            <td><input type='number' value=''/></td>
        </tr>
    </table>
    </form>
  </div>
  <div id="tabs-3">
    <form class='pure-form pure-form-aligned'>
        <tr>
            <td><label>Allowance amount: </label></td>
            <td><input type='number' value=''/></td>
        </tr>
    </form>
  </div>
    <div id="tabs-4">
        <br/>
            <table class='pure-table'>
                <thead id='CPth'>
                    <tr>
                        <th>Name</th>
                        <th>Landline</th>
                        <th>Mobile</th>
                        <th>Birthdate</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id='CPtd'>
                    {% for CP in ContactPersons %}
                    <tr>
                        <td>{{ CP.FirstName }} {{ CP.LastName }}
                        <td>{{ CP.Landline }}</td>
                        <td>{{ CP.MobileNo }}</td>
                        <td>{{ CP.BirthDate }}</td>
                        <td><form method='link' action=''><button class='pure-button'>Edit</button></form></td>
                        <td><form method='link' action=''><button class='pure-button'>Delete</button></form></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <br/>
            <input type='button' class="pure-button" value='Add new contact'/>
            <br />
  </div>


</div>
<br/>
    


<!------SCRIPT FOR ListJS search contact ------->
<script>
var client_options = {
  valueNames: [ 'contact_id', 'contact_name', 'position', 'number' ]
};

// Init list
var contactList = new List('contacts', client_options);

var contact_idField = $('#contact_id-field'),
    contact_nameField = $('#contact_name-field'),
    positionField = $('#position-field'),
    numberField = $('#number-field'),
    addBtn = $('#add-btn'),
    editBtn = $('#edit-btn').hide(),
    removeBtns = $('.remove-item-btn'),
    editBtns = $('.edit-item-btn');

// Sets callbacks to the buttons in the list
refreshCallbacks();

addBtn.click(function() {
  contactList.add({
    contact_id: Math.floor(Math.random()*110000),
    contact_name: contact_nameField.val(),
    position: positionField.val(),
    number: numberField.val()
  });
  clearFields();
  refreshCallbacks();
});

editBtn.click(function() {
  var item = contactList.get('contact_id', contact_idField.val())[0];
  item.values({
    contact_id:contact_idField.val(),
    contact_name: contact_nameField.val(),
    position: positionField.val(),
    number: numberField.val()
  });
  clearFields();
  editBtn.hide();
  addBtn.show();
});

function refreshCallbacks() {
  // Needed to add new buttons to jQuery-extended object
  removeBtns = $(removeBtns.selector);
  editBtns = $(editBtns.selector);
  
  removeBtns.click(function() {
    var itemId = $(this).closest('tr').find('.contact_id').text();
    contactList.remove('contact_id', itemId);
  });
  
  editBtns.click(function() {
    var itemId = $(this).closest('tr').find('.contact_id').text();
    var itemValues = contactList.get('contact_id', itemId)[0].values();
    contact_idField.val(itemValues.contact_id);
    contact_nameField.val(itemValues.contact_name);
    positionField.val(itemValues.position);
    numberField.val(itemValues.number);
    
    editBtn.show();
    addBtn.hide();
  });
}

function clearFields() {
  contact_nameField.val('');
  positionField.val('');
  numberField.val('');
}    
</script>    
{% endblock content %}